// Generated by CoffeeScript 1.8.0
(function() {
  var $janishPlus, DRAGGING_ILLUSION_FROM_LIST, DRAGGING_ILLUSION_FROM_PANEL, DRAGGING_OUTPUT_FROM_PANEL, colHeight, currentDraggingData, currentDraggingType, currentIllusionList, documentReady, drawJanish, drawPadding, illusionDict, illusions, loadIllusions, loadJanish, logLocation, panel_janish, setupDropEvent, templateJanishItem, templateJanishSub;

  illusions = null;

  illusionDict = {};

  currentIllusionList = 0;

  currentDraggingType = 0;

  currentDraggingData = null;

  DRAGGING_ILLUSION_FROM_LIST = 1;

  DRAGGING_ILLUSION_FROM_PANEL = 2;

  DRAGGING_OUTPUT_FROM_PANEL = 3;

  panel_janish = [
    {
      "id": "list_file_1",
      "illusion": "LS",
      "input": {
        "path": "."
      }
    }, {
      "id": "for_each_1",
      "illusion": "FOR",
      "input": {
        "list": "#list_file_1.file_list"
      },
      "sub": {
        "body": {
          "id": "print_1",
          "illusion": "PRINT",
          "input": {
            "content": "#for_each_1.iterator"
          }
        }
      }
    }
  ];

  logLocation = function() {
    var $illusion1;
    $illusion1 = $("#illusion-2");
    console.log($("#illusion-1").position());
    console.log($("#illusion-2").position());
    return console.log($("#illusion-3").position());
  };

  loadIllusions = function() {
    var $illusionList, $illusionType, $item, createDragStart, i, ill, illusion, illusionType, setChangeCurrentIllusionList, str_i, templateIllusionItem, templateIllusionTypeItem, _i, _j, _len, _len1, _ref, _ref1, _results;
    for (_i = 0, _len = illusions.length; _i < _len; _i++) {
      illusionType = illusions[_i];
      _ref = illusionType["list"];
      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
        illusion = _ref[_j];
        illusionDict[illusion["illusion"]] = illusion;
      }
    }
    templateIllusionTypeItem = _template($("#template-illusion-type-item").html());
    $illusionType = $("#illusion-type");
    $illusionType.html("");
    for (str_i in illusions) {
      ill = illusions[str_i];
      i = parseInt(str_i);
      if (currentIllusionList === i) {
        ill["current"] = true;
      } else {
        ill["current"] = false;
      }
      $item = $(templateIllusionTypeItem(ill));
      setChangeCurrentIllusionList = function() {
        var newListId, onClick;
        newListId = i;
        onClick = function() {
          currentIllusionList = newListId;
          return loadIllusions();
        };
        return onClick;
      };
      $item.click(setChangeCurrentIllusionList());
      $illusionType.append($item);
    }
    templateIllusionItem = _template($("#template-illusion-item").html());
    $illusionList = $("#illusion-list");
    $illusionList.html("");
    _ref1 = illusions[currentIllusionList]["list"];
    _results = [];
    for (str_i in _ref1) {
      ill = _ref1[str_i];
      $item = $(templateIllusionItem(ill));
      createDragStart = function() {
        var currentIll, dragStart;
        currentIll = ill;
        dragStart = function() {
          currentDraggingType = DRAGGING_ILLUSION_FROM_LIST;
          return currentDraggingData = currentIll;
        };
        return dragStart;
      };
      $item.on("dragstart", createDragStart());
      _results.push($illusionList.append($item));
    }
    return _results;
  };

  setupDropEvent = function() {
    $(".illusion-plus").on("dragover", function(e) {
      e.preventDefault();
      return $(this).addClass("drag-over");
    });
    $(".illusion-plus").on("dragleave", function(e) {
      e.preventDefault();
      return $(this).removeClass("drag-over");
    });
    return $(".illusion-plus").on("drop", function(e) {
      console.log(currentDraggingType);
      return console.log(currentDraggingData);
    });
  };

  colHeight = [];

  drawPadding = function(col, height) {
    var $padding;
    $padding = $("<div></div>");
    $padding.css("height", height - 7);
    return $("#janish-col-" + col).append($padding);
  };

  templateJanishItem = _template($("#template-janish-item").html());

  templateJanishSub = _template($("#template-janish-sub").html());

  $janishPlus = $("#template-janish-plus").html();

  drawJanish = function(janish, col) {
    var $janish, height, illusion, j, key, output, sub_janish, _i, _len, _ref;
    if (Array.isArray(janish)) {
      for (_i = 0, _len = janish.length; _i < _len; _i++) {
        j = janish[_i];
        drawJanish(j, col);
      }
    } else {
      illusion = illusionDict[janish["illusion"]];
      console.log(illusion);
      $janish = $(templateJanishItem(illusion));
      $("#janish-col-" + col).append($janish);
      if (illusion.sub) {
        height = $janish.position().top;
        _ref = illusion.sub;
        for (key in _ref) {
          output = _ref[key];
          col++;
          drawPadding(col, height);
          $("#janish-col-" + col).append(templateJanishSub({
            "name": key,
            "output": output
          }));
          if (janish["sub"] && janish["sub"][key]) {
            sub_janish = janish["sub"][key];
            drawJanish(sub_janish, col);
          }
          $("#janish-col-" + col).append($janishPlus);
        }
      }
    }
    return col;
  };

  loadJanish = function() {
    var $item, $janishPanel, i, _i;
    console.log(panel_janish);
    colHeight = [];
    $janishPanel = $("#janish-panel");
    $janishPanel.html("");
    for (i = _i = 0; _i < 20; i = ++_i) {
      colHeight.push(0);
      $item = $('<div class="janish-col"></div>');
      $item.attr("id", "janish-col-" + i);
      $janishPanel.append($item);
    }
    drawJanish(panel_janish, 0);
    return $("#janish-col-0").append($janishPlus);
  };

  documentReady = function() {
    $.ajax({
      "url": "illusions.json",
      "dataType": "json",
      "success": function(data) {
        illusions = data;
        loadIllusions();
        return loadJanish();
      }
    });
    return setupDropEvent();
  };

  $(document).ready(documentReady);

}).call(this);

//# sourceMappingURL=editor.js.map
